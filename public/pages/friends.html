<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch b·∫°n b√®</title>
  <link rel="stylesheet" href="/style.css">

</head>
<body>
  <div class="navbar">
    <div class="logo">SocialApp</div>
    <div class="nav-links">
      <a href="/home">Trang ch·ªß</a>
      <a href="/post">Th√™m b·∫°n b√®</a>
      <a href="/Users">B·∫°n b√®</a>
      <a href="/socket">Th√¥ng tin</a>
    </div>
  </div>

  <div class="container-friend">
    <h1>Danh s√°ch b·∫°n b√®</h1>

  <label for="searchInput">T√¨m ki·∫øm <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm b·∫°n b√®..." onkeyup="searchUsers()"></label>
  <br>
  <div style="margin-bottom: 20px;">
    <!-- T√¨m ki·∫øm theo danh m·ª•c (gi·ªõi t√≠nh l√† v√≠ d·ª•) -->
    <label>Gi·ªõi t√≠nh:</label>
    <select id="gender">
      <option value="">-- T·∫•t c·∫£ --</option>
      <option value="0">Nam</option>
      <option value="1">N·ªØ</option>
    </select>
  
    <!-- G·∫ßn ƒë√∫ng theo string -->
    <label>Username:</label>
    <input type="text" id="username" placeholder="Nh·∫≠p username g·∫ßn ƒë√∫ng">
  
    <label>Email:</label>
    <input type="text" id="email" placeholder="Nh·∫≠p email g·∫ßn ƒë√∫ng">
  
    <!-- Trong kho·∫£ng s·ªë -->
    <label>Tu·ªïi t·ª´:</label>
    <input type="number" id="ageMin" placeholder="T·ªëi thi·ªÉu" style="width: 70px;">
    <label>ƒë·∫øn</label>
    <input type="number" id="ageMax" placeholder="T·ªëi ƒëa" style="width: 70px;">
  
    <!-- T√¨m ki·∫øm -->
    <button onclick="applyFilters()">üîç T√¨m ki·∫øm</button>
    <button onclick="resetFilters()">üîÑ Reset</button>
  </div>


  <div class="container-friends-list">
    <table id="friendsTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Gender</th>
          <th>Chi ti·∫øt</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    
    <div id="pagination"></div>
  </div>
  </div>

  <script>
    let currentPage = 1;

    function loadUsers(page = currentPage) {
      fetch(`/Users/displayUser?page=${page}`)
        .then(res => res.json())
        .then(({ data, totalPages }) => {
          const tbody = document.querySelector('#friendsTable tbody');
          tbody.innerHTML = '';

          data.forEach(user => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${user._id}</td>
              <td>${user.username}</td>
              <td>${user.email}</td>
              <td>${user.gender === 0 ? "Nam" : "N·ªØ"}</td>
              <td><button onclick="viewUser('${user._id}')">Chi ti·∫øt</button></td>
            `;
            tbody.appendChild(row);
          });

          renderPagination(totalPages);
        })
        .catch(err => console.error('‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu:', err));
    }

    function renderPagination(totalPages) {
      const container = document.getElementById('pagination');
      container.innerHTML = '';
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.onclick = () => {
          currentPage = i;
          loadUsers();
        };
        container.appendChild(btn);
      }
    }

    function viewUser(id) {
      fetch(`/Users/displayUser/${id}`)
        .then(res => res.json())
        .then(user => {
          alert(` ${user.name.first} ${user.name.last}\n${user.email}\n${user.profile.phone}`);
        })
        .catch(err => alert('Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt ng∆∞·ªùi d√πng.'));
    }

    function searchUsers() {
      const searchInput = document.getElementById('searchInput').value.toLowerCase();
      const rows = document.querySelectorAll('#friendsTable tbody tr');
      rows.forEach(row => {
        const username = row.cells[1].textContent.toLowerCase();
        if (username.includes(searchInput)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    loadUsers();
  </script>
  
</body>
</html>
